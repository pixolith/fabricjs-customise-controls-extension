!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=function(){return"undefined"!=typeof G_vmlCanvasManager},d=b.util.degreesToRadians,e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};b.util.object.extend(b.Object.prototype,{useCustomIcons:!1,cornerBackgroundColor:"transparent",cornerShape:"",cornerPadding:0,customiseCornerIcons:function(a,b){var c;for(c in a)a.hasOwnProperty(c)&&(void 0!==a[c].cornerShape&&(this.cornerShape=a[c].cornerShape),void 0!==a[c].cornerBackgroundColor&&(this.cornerBackgroundColor=a[c].cornerBackgroundColor),void 0!==a[c].borderColor&&(this.borderColor=a[c].borderColor),void 0!==a[c].cornerSize&&(this.cornerSize=a[c].cornerSize),void 0!==a[c].cornerPadding&&(this.cornerPadding=a[c].cornerPadding),void 0!==a[c].icon&&(this.useCustomIcons=!0,this.loadIcon(c,a[c].icon,function(){b&&"function"==typeof b&&b()})))},loadIcon:function(a,c,d){var e=this,f=new Image;f.onload=function(){e[a+"Icon"]=this,d&&"function"==typeof d&&d()},f.onerror=function(){b.warn(this.src+" icon is not an image")},f.src=c},customizeCornerIcons:function(a){this.customiseCornerIcons(a)},drawControls:function(a){if(!this.hasControls)return this;var b,c=this._calculateCurrentDimensions(!0),d=c.x,e=c.y,f=-(d/2),g=-(e/2),h=this.cornerSize/2;return this.useCustomIcons?b="drawImage":(a.lineWidth=1,a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,b=this.transparentCorners?"strokeRect":"fillRect"),a.save(),this._drawControl("tl",a,b,f-h,g-h,this.tlIcon),this._drawControl("tr",a,b,f+d-h,g-h,this.trIcon),this._drawControl("bl",a,b,f-h,g+e-h,this.blIcon),this._drawControl("br",a,b,f+d-h,g+e-h,this.brIcon),this.get("lockUniScaling")||(this._drawControl("mt",a,b,f+d/2-h,g-h,this.mtIcon),this._drawControl("mb",a,b,f+d/2-h,g+e-h,this.mbIcon),this._drawControl("mr",a,b,f+d-h,g+e/2-h,this.mrIcon),this._drawControl("ml",a,b,f-h,g+e/2-h,this.mlIcon)),this.hasRotatingPoint&&this._drawControl("mtr",a,b,f+d/2-h,g-this.rotatingPointOffset-h,this.mtrIcon),a.restore(),this},_drawControl:function(a,b,d,e,f,g){if(this.isControlVisible(a)){var h=this.cornerSize,i=this.cornerBackgroundColor||"black",j=this.cornerShape||"rect",k=this.cornerPadding||10;if(this.useCustomIcons)if(j)switch(b.globalAlpha=1,b.fillStyle=i,j){case"rect":b.fillRect(e,f,h,h),void 0!==g&&b[d](g,e+k/2,f+k/2,h-k,h-k);break;case"circle":b.beginPath(),b.arc(e+h/2,f+h/2,h/2,0,2*Math.PI),b.fill(),b.closePath(),void 0!==g&&b[d](g,e+k/2,f+k/2,h-k,h-k)}else void 0!==g&&b[d](g,e,f,h,h);else c()||this.transparentCorners||b.clearRect(e,f,h,h),b[d](e,f,h,h)}}}),b.util.object.extend(b.Canvas.prototype,{overwriteActions:!1,fixedCursors:!1,customiseControls:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(void 0!==a[b].action&&(this.overwriteActions=!0,this.setCustomAction(b,a[b].action)),void 0!==a[b].cursor&&(this.fixedCursors=!0,this.setCustomCursor(b,a[b].cursor)))},setCustomAction:function(a,b){this[a+"Action"]=b},setCustomCursor:function(a,b){this[a+"cursorIcon"]=b},customizeControls:function(a){this.customiseControls(a)},_getActionFromCorner:function(a,b){var c="drag";return b?c=this.overwriteActions?"ml"===b?this.mlAction||"scaleX":"mr"===b?this.mrAction||"scaleX":"mt"===b?this.mtAction||"scaleY":"mb"===b?this.mbAction||"scaleY":"tr"===b?this.trAction||"scale":"tl"===b?this.tlAction||"scale":"bl"===b?this.blAction||"scale":"br"===b?this.brAction||"scale":"mtr"===b?this.mtrAction||"rotate":"scale":"ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale":void 0},_setupCurrentTransform:function(a,b){if(b){var c=this.getPointer(a),e=b._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(b,e,a),g=this._getOriginFromCorner(b,e);this._currentTransform={target:b,action:f,corner:e,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,offsetX:c.x-b.left,offsetY:c.y-b.top,originX:g.x,originY:g.y,ex:c.x,ey:c.y,lastX:c.x,lastY:c.y,left:b.left,top:b.top,theta:d(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a.altKey},this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,originX:g.x,originY:g.y},"remove"===f&&this._removeAction(a,b),"moveUp"===f&&this._moveLayerUpAction(a,b),"moveDown"===f&&this._moveLayerDownAction(a,b),"object"==typeof f&&"rotateByDegrees"===Object.keys(f)[0]&&this._rotateByDegrees(a,b,f.rotateByDegrees),this._resetCurrentTransform()}},_removeAction:function(a,b){this.getActiveGroup()&&"undefined"!==this.getActiveGroup()?(this.getActiveGroup().forEachObject(function(a){a.remove()}),this.discardActiveGroup()):b.remove()},_moveLayerUpAction:function(a,b){this.getActiveGroup()&&"undefined"!==this.getActiveGroup()?this.getActiveGroup().forEachObject(function(a){a.bringForward()}):b.bringForward()},_moveLayerDownAction:function(a,b){this.getActiveGroup()&&"undefined"!==this.getActiveGroup()?this.getActiveGroup().forEachObject(function(a){a.sendBackwards()}):b.sendBackwards()},_rotateByDegrees:function(a,b,c){var d=b.getAngle()+c;d=d>360?c:0>d?315:d,this.getActiveGroup()&&"undefined"!==this.getActiveGroup()?this.getActiveGroup().forEachObject(function(a){a.setAngle(d).setCoords()}):b.setAngle(d).setCoords(),this.renderAll()},_setOriginToCenter:function(a){a._originalOriginX=a.originX,a._originalOriginY=a.originY;var b=a.getCenterPoint();a.set({originX:"center",originY:"center",left:b.x,top:b.y})},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),a._originalOriginX,a._originalOriginY);a.set({originX:a._originalOriginX,originY:a._originalOriginY,left:b.x,top:b.y})},_setCornerCursor:function(a,b,c){var d=/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/;if(this.fixedCursors)a in e&&(this[a+"cursorIcon"]?d.test(this[a+"cursorIcon"])?this.setCursor("url("+this[a+"cursorIcon"]+"), auto"):"resize"===this[a+"cursorIcon"]?this._setScalingCursor(a,b):this.setCursor(this[a+"cursorIcon"]):this._setScalingCursor(a,b));else if(a in e)this.setCursor(this._getRotatedCornerCursor(a,b,c));else{if("mtr"!==a||!b.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_setScalingCursor:function(a,b){this.setCursor(this._getRotatedCornerCursor(a,b))}})}("undefined"!=typeof exports?exports:this);