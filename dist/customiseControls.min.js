"use strict";!function(t){var i=t.fabric||(t.fabric={}),e="1.6.0",c=i.util.degreesToRadians,o={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};-1<e.localeCompare(t.fabric.version)&&console.warn("this extension might not be fully compatible with your version of fabric.js ("+t.fabric.version+").Consider using the latest compatible build of fabric.js (> "+e+")"),i.util.object.extend(i.Object.prototype,{useCustomIcons:!1,cornerBackgroundColor:"transparent",cornerShape:"",cornerPadding:0,customiseCornerIcons:function(t,e){var r,o;for(r in t)t.hasOwnProperty(r)&&(o={},void 0!==t[r].cornerShape&&(this.cornerShape=t[r].cornerShape),void 0!==t[r].cornerBackgroundColor&&(this.cornerBackgroundColor=t[r].cornerBackgroundColor),void 0!==t[r].borderColor&&(this.borderColor=t[r].borderColor),void 0!==t[r].cornerSize&&(this.cornerSize=t[r].cornerSize),void 0!==t[r].cornerPadding&&(this.cornerPadding=t[r].cornerPadding),void 0===t[r].icon&&"settings"!==Object.keys(t)[0]||(this.useCustomIcons=!0,void 0!==t[r].settings&&(o.settings=t[r].settings),void 0!==t[r].icon&&(o.icon=t[r].icon,this.loadIcon(r,o,function(){e&&"function"==typeof e&&e()}))))},loadIcon:function(t,e,r){var o=this,s=new Image;s.onload=function(){o[t+"Icon"]=this,e.settings&&(o[t+"Settings"]=e.settings),r&&"function"==typeof r&&r()},s.onerror=function(){i.warn(this.src+" icon is not an image")},(e.icon.match(/^http[s]?:\/\//)||"//"===e.icon.substring(0,2))&&(s.crossOrigin="Anonymous"),s.src=e.icon},customizeCornerIcons:function(t){this.customiseCornerIcons(t)},drawControls:function(t){if(!this.hasControls)return this;var e,r=this._calculateCurrentDimensions(),o=r.x,s=r.y,i=this.cornerSize,n=-(o+i)/2,c=-(s+i)/2;return this.useCustomIcons?e="drawImage":(t.lineWidth=1,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),e=this.transparentCorners?"stroke":"fill"),t.save(),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,e,n,c,this.tlIcon,this.tlSettings),this._drawControl("tr",t,e,n+o,c,this.trIcon,this.trSettings),this._drawControl("bl",t,e,n,c+s,this.blIcon,this.blSettings),this._drawControl("br",t,e,n+o,c+s,this.brIcon,this.brSettings),this.get("lockUniScaling")||(this._drawControl("mt",t,e,n+o/2,c,this.mtIcon,this.mtSettings),this._drawControl("mb",t,e,n+o/2,c+s,this.mbIcon,this.mbSettings),this._drawControl("mr",t,e,n+o,c+s/2,this.mrIcon,this.mrSettings),this._drawControl("ml",t,e,n,c+s/2,this.mlIcon,this.mlSettings)),this.hasRotatingPoint&&this._drawControl("mtr",t,e,n+o/2,c-this.rotatingPointOffset,this.mtrIcon,this.mtrSettings),t.restore(),this},_drawControl:function(t,e,r,o,s,i,n){if(this.isControlVisible(t)){var c=this.cornerSize,a=this.cornerStrokeColor||"transparent",h=this.cornerBackgroundColor||"black",l=this.cornerShape||"rect",u="number"==typeof this.cornerPadding?this.cornerPadding:10;if(n&&(n.cornerSize&&(o=o+c/2-n.cornerSize/2,s=s+c/2-n.cornerSize/2,c=n.cornerSize),l=n.cornerShape||l,h=n.cornerBackgroundColor||h,u="number"==typeof n.cornerPadding?n.cornerPadding:u,a=n.cornerStrokeColor||a),this.useCustomIcons)if(l){switch(e.globalAlpha=1,e.fillStyle=h,e.lineWidth=1,e.strokeStyle=a,l){case"rect":e.fillRect(o,s,c,c),a&&e.strokeRect(o,s,c,c);break;case"circle":e.beginPath(),e.arc(o+c/2,s+c/2,c/2,0,2*Math.PI),e.fill(),a&&e.stroke(),e.closePath()}void 0!==i&&e[r](i,o+u/2,s+u/2,c-u,c-u)}else void 0!==i&&e[r](i,o,s,c,c);else"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(o,s,c,c),e[r+"Rect"](o,s,c,c),!this.transparentCorners&&a&&e.strokeRect(o,s,c,c)}}}),i.util.object.extend(i.Canvas.prototype,{overwriteActions:!1,fixedCursors:!1,customiseControls:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(void 0!==t[e].action&&(this.overwriteActions=!0,this.setCustomAction(e,t[e].action)),void 0!==t[e].cursor&&(this.fixedCursors=!0,this.setCustomCursor(e,t[e].cursor)))},setCustomAction:function(t,e){this[t+"Action"]=e},setCustomCursor:function(t,e){this[t+"cursorIcon"]=e},customizeControls:function(t){this.customiseControls(t)},_getActionFromCorner:function(t,e,r){if(!e)return"drag";if(e)if(this[e+"Action"]&&this.overwriteActions)switch(e){case"mtr":return this[e+"Action"]||"rotate";case"ml":case"mr":return r[this.altActionKey]?r[this.altActionKey]?"skewY":"scaleX":this[e+"Action"];case"mt":case"mb":return r[this.altActionKey]?r[this.altActionKey]?"skewY":"scaleY":this[e+"Action"];default:return this[e+"Action"]||"scale"}else switch(e){case"mtr":return"rotate";case"ml":case"mr":return r[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return r[this.altActionKey]?"skewX":"scaleY";default:return"scale"}return!1},_setupCurrentTransform:function(t,e,r){if(console.log(e,r),e){var o=this.getPointer(t),s=e._findTargetCorner(this.getPointer(t,!0)),i=this._getActionFromCorner(e,s,t),n=this._getOriginFromCorner(e,s);"function"==typeof i&&(i.call(this,t,e),i="void"),("remove"!==i||r)&&(this._currentTransform={target:e,action:i,corner:s,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:o.x-e.left,offsetY:o.y-e.top,originX:n.x,originY:n.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,left:e.left,top:e.top,theta:c(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:n.x,originY:n.y},"remove"===i&&this._removeAction(t,e),"moveUp"===i&&this._moveLayerUpAction(t,e),"moveDown"===i&&this._moveLayerDownAction(t,e),"object"==typeof i&&"rotateByDegrees"===Object.keys(i)[0]&&this._rotateByDegrees(t,e,i.rotateByDegrees),this._resetCurrentTransform())}},_removeAction:function(t,e){var r=this;this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.off(),r.discardActiveObject(),r.remove(t)}):(e.off(),this.discardActiveObject(),this.remove(e))},_moveLayerUpAction:function(t,e){this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.bringForward()}):e.bringForward()},_moveLayerDownAction:function(t,e){this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.sendBackwards()}):e.sendBackwards()},_rotateByDegrees:function(t,e,r){var o=parseInt(e.get("angle"))+r,s=!1;"center"===e.originX&&"center"===e.originY||!e.centeredRotation||(this._setOriginToCenter(e),s=!0),o=360<o?o-360:o,this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.set("angle",o).setCoords()}):e.set("angle",o).setCoords(),s&&this._setCenterToOrigin(e),this.renderAll()},getCornerCursor:function(t,e,r){if(this.actionIsDisabled(t,e,r))return this.notAllowedCursor;if(this.fixedCursors&&this[t+"cursorIcon"])this[t+"cursorIcon"].match(/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/)?this.setCursor("url("+this[t+"cursorIcon"]+"), auto"):"resize"===this[t+"cursorIcon"]?this.setCursor(this._getRotatedCornerCursor(t,e,r)):this.setCursor(this[t+"cursorIcon"]);else if(t in o)this.setCursor(this._getRotatedCornerCursor(t,e,r));else{if("mtr"!==t||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}return!1}}),"undefined"!=typeof exports&&(module.exports=this)}(window);